if (WIN32)
  add_definitions(-D__BUILD_GADGETS__)
  link_directories(${Boost_LIBRARY_DIRS})
endif ()

add_subdirectory(mri_core)
add_subdirectory(interventional_mri)
add_subdirectory(cmr)
add_subdirectory(epi)
add_subdirectory(fatwater)

if(BART_FOUND)
  add_subdirectory(bart)
else()
  message("BART not found, NOT compiling bartgadget")
endif()

if (CUDA_FOUND)
  message("Cuda found, compiling gpu accelerated gadgets")
  add_subdirectory(pmri)
  add_subdirectory(radial)  
  add_subdirectory(hyper)
  add_subdirectory(gpu)
  add_subdirectory(mri_noncartesian)
else ()
  message("Cuda NOT found, NOT compiling gpu accelerated gadgets")
endif()

add_subdirectory(spiral)
add_subdirectory(grappa)

if (MATLAB_FOUND)
  message("Compiling MATLAB gadgets")
  add_subdirectory(matlab)
endif()

if (BUILD_PYTHON_SUPPORT)
  if(BUILD_WITH_PYTHON3)
    find_package(Boost COMPONENTS python3 system thread)
    message("Boost_PYTHON3_FOUND is ${Boost_PYTHON3_FOUND}")
  else()
    find_package(Boost COMPONENTS python system thread)
    message("Boost_PYTHON_FOUND is ${Boost_PYTHON_FOUND}")
  endif()

  # Note: main CMakeLists.txt already finds PythonLibs and NumPy

  if ((Boost_PYTHON3_FOUND OR Boost_PYTHON_FOUND) AND PYTHONLIBS_FOUND AND NUMPY_FOUND)
    message(STATUS "PYTHON_INCLUDE_DIRS: ${PYTHON_INCLUDE_DIRS}")
    message(STATUS "PYTHON_LIBRARIES: ${PYTHON_LIBRARIES}")
    message(STATUS "NUMPY_INCLUDE_DIRS: ${NUMPY_INCLUDE_DIRS}")
    message(STATUS "Compiling Python Gadgets")
    add_subdirectory(python)
    add_definitions(-DCOMPILING_WITH_PYTHON_SUPPORT)
  else ()
    if(NOT Boost_PYTHON_FOUND)
        message(STATUS "Boost Python NOT found, NOT compiling Python Gadgets")
    endif()
    set(BUILD_PYTHON_SUPPORT OFF)
  endif ()
endif () # BUILD_PYTHON_SUPPORT

#add_subdirectory(distributed)
#add_subdirectory(util)

find_package(DCMTK)
if(DCMTK_FOUND)
  message("Compiling DICOM gadget")
  add_subdirectory(dicom)
else()
  message("DCMTK NOT found, not compiling DICOM gadget")
endif()

add_subdirectory(cartesian)

if(ARMADILLO_FOUND)
    add_subdirectory(moco)
endif()

if(PLPLOT_FOUND)
    if (MKL_FOUND OR ARMADILLO_FOUND)
        add_subdirectory(plplot)
    endif ()
endif()
